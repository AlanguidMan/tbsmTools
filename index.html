<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Fact Sheets Downloader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        .download-status {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fact Sheets Downloader</h1>
        <div id="status"></div>
    </div>
    <script>
        const my_list = [
            "https://niftyindices.com/Factsheet/ind_nifty50.pdf",
            // Add other URLs here
        ];

        async function downloadContent(url) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                    }
                });

                const lastModifiedStr = response.headers.get('Last-Modified');
                if (!lastModifiedStr) {
                    console.log('Last-Modified header not available for', url);
                    return;
                }

                const lastModifiedDatetime = new Date(lastModifiedStr);
                const currentDate = new Date();
                const currentMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                const nextMonthFirstDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);

                if (!(lastModifiedDatetime >= currentDate - 2 * 24 * 60 * 60 * 1000 && lastModifiedDatetime <= currentMonthLastDay.getTime() + 2 * 24 * 60 * 60 * 1000) &&
                    !(lastModifiedDatetime >= nextMonthFirstDay - 2 * 24 * 60 * 60 * 1000 && lastModifiedDatetime <= nextMonthFirstDay.getTime() + 2 * 24 * 60 * 60 * 1000)) {
                    console.log(`${url} not updated. Last modified: ${lastModifiedDatetime}`);
                    return;
                }

                if (response.ok) {
                    const blob = await response.blob();
                    const filename = `factSheets/${url.split('/').pop()}`;
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    console.log(`Downloaded ${url}`);
                    document.getElementById('status').innerHTML += `<div class="download-status">Downloaded ${url}</div>`;
                } else {
                    console.error(`Failed to download ${url}. Status code: ${response.status}`);
                    document.getElementById('status').innerHTML += `<div class="download-status">Failed to download ${url}. Status code: ${response.status}</div>`;
                }
            } catch (error) {
                console.error(`Error downloading ${url}:`, error);
                document.getElementById('status').innerHTML += `<div class="download-status">Error downloading ${url}: ${error.message}</div>`;
            }
        }

        async function downloadAll() {
            const startTime = performance.now();

            for (const url of my_list) {
                await downloadContent(url);
            }

            const endTime = performance.now();
            const executionTime = (endTime - startTime) / 1000; // in seconds

            console.log(`Downloaded ${my_list.length} items in ${executionTime} seconds`);
            document.getElementById('status').innerHTML += `<div class="download-status">Downloaded ${my_list.length} items in ${executionTime.toFixed(2)} seconds</div>`;
        }

        downloadAll();
    </script>
</body>
</html>
